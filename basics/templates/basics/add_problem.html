{% extends 'basics/base_index.html' %}

{% block content %}
  <h1>Add new problem</h1>

  <form id="add_problem" action="{% url 'basics:add_problem' %}" method="post">
    {% csrf_token %}
    {{ formVar }}
    <input type="submit" value="Add">
  </form>

  <div>
    <input type="text">
    <input type="text">
    <input type="text">
  </div>

  <script>
    $(document).ready(function() {
      // $("body").bind("ajaxSend", function(elem, xhr, req) {
      //   if (req.type == "POST") {
      //     xhr.setRequestHeader("")
      //   }
      // })
      // console.log($("meta[name='csrf-token']").attr("content"));

      function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
      }
      $.ajaxSetup({
        beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", $("meta[name='csrf-token']").attr("content"));
          }
        }
      });

      var add_problem_choices_url = "{% url 'basics:add_problem_choices' %}";
      $("form#add_problem input[type='submit']").click(function() {
        var data = {"choices":[{"text":"asdfasdfs","correctness":true},{"text":"fjdskla","correctness":false}]};
        // var data = {"lol":[{"text":"text111","corr":true},{"text":"text222","corr":false}]};

        // IF THE NAME OF THE TITLE FIELD CHANGES IN PYTHON, this will break
        data["title"] = $("form#add_problem input[name='title']").val();

        $.post(add_problem_choices_url, data, function(response) {
          console.log(response);
        })
      });
    });
  </script>
{% endblock %}
